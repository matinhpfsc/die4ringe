<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
      <title>Die vier Schl&uuml;ssel</title>
   </head>
   <body onLoad="init();">
     <script>

         var commands = [
            {
               pattern: /say\s+"([^"]*)"(\s+in\s+(#[0-9A-F]{6}))?/g,
               func: function(groups) {say(groups[3], groups[1]);}
            }
         ];

         function createTextReader(text) {
            var currentIndex = 0;
            var lines = text.replace(/\r/g, "").split("\n");

            return {
               currentLine: function() {
                  return currentIndex < lines.length ? lines[currentIndex] : null;
               },
               nextLine: function() {
                  if (currentIndex < lines.length) currentIndex++;
               },
               lastLine: function() {
                  if (currentIndex > 0) currentIndex--;
               },
            };
         }

         function getStatement(reader) {
            var line = reader.currentLine(); 
            var result;
            for (command of commands) {
               result = line.match(command.pattern);
               if (result != null) {
                  return function() { command.func(result) };
               }
            }
            return null;
         }


         function getIndentLevel(line) {
            if (line == null) {
               return -1;
            }
            var regex = /^\s*/g;
            var indent = regex.exec(line);
            if (indent == null) {
               return 0;
            }
            return indent[0].length;
         }

         function getBlockStatements(reader) {
            var statements = [];
            if (reader.currentLine() == null) {
               return statements;
            }
            var indentLevel = getIndentLevel(reader.currentLine());
            while (indentLevel <= getIndentLevel(reader.currentLine())) {
               statements.push(getStatement(reader));
               reader.nextLine();
            }
            return statements;
         }

         var texts = ["Ich bin Peter Kowalskie ein mächtiger Sänger.", "Naja, eigentlich möchte ich U-Boot fahren.", "Wissen Sie, wie man von hier zum Hafen kommt?"
         ];
         var index = 0;

         function nextStep() {
            var dialogDiv =  document.getElementById('dialog');
            if (index < texts.length) {
               dialogDiv.innerHTML = texts[index];
               setTimeout(function() { dialogDiv.innerHTML = ""; nextStep() }, 25 * texts[index].length + 2000);
               index++;
            }
         }

         function init() {
            var text = 'say "Hallo, wie gehts."\nsay "Genau so gehts." in #FF0000';
            var reader = createTextReader(text);
            var statements = getBlockStatements(reader);
            //var dialogDiv =  document.getElementById('dialog');
            //dialogDiv.innerHTML = 'Hallo wie gehts';
            //setTimeout(nextStep, 3000);
            nextStep();
  /*          var statements = [
               'say "Dies ist meine erste Aussage."',
               'say "Und dies ist meine zweite."'
            ];
            var dialogDiv =  document.getElementById('dialog');
            for (var i = 0; i < statements.length; i++) {
               
            }
            dialogDiv.innerHTML = 'Hallo wie gehts';*/
         }
/*
         function run(statements) {
            for (var i = 0; i < statements.length; i++) {
               statements[i].run();
            }
         }

         function condition(branches) {
            for (var i = 0; i < branches.length; i++) {
               var branch = branches[i];
               if (branch.checkFunction(branch.firstArgument,
                        branch.secondArgument)) {
                  run(branch.statements);
                  return;
               }
            }
         }
      */
         function say(color, text) {
            //Assert: parameters.length >= 1 && parameters.length <= 2
            //Assert: parameters[0] is string, parameters[1] is color 
         }
         
      </script>
      <div id="dialog" style="min-height:7em; width:30em; margin:auto;"><!--Ich kann die Dose ohne Dosenöffner nicht öffnen. Da fällt mir folgender Witz ein: Wie nennt man einen Dosenöffner ohne Wasserhahn? Enemene Miste was rappelt in der Kiste? Ich weiß es nicht.--></div>
      <div id="room" style="border-style:solid; width:30em; margin:auto;">In einer Ecke steht eine kleine Miniküche mit <a href="">Kochfeld</a>, <a href="">Spüle</a> und <a href="">Kühlschrank</a>. In der Ecke gegenüber steht ein Küchenschrank mit <a href="">Besteck</a>-|Besteckschublade_ und <a href="">Zubehörschublade</a> sowie einem <a href="">Regal</a> für Gläser und Tassen und einem <a href="">Geschirrfach</a>. In der Mitte steht ein <a href="">Tisch</a> mit Stühlen.</div>
      <div id="command" style="margin:1em; text-align:center;">Benutze Tür mit Schlüssel</div>
      <div style="width:40em; margin:auto;">
      <table style="width:20em; float:left;">
         <tr><td><a href="">Nimm</a></td><td><a href="">Öffne</a></td><td><a href="">Ziehe</a></td></tr>
         <tr><td><a href="">Gib</a></td><td><a href="">Schließe</a></td><td><a href="">Drücke</a></td></tr>
         <tr><td><a href="">Rede mit</a></td><td><a href="">Schau an</a></td><td><a href="">Benutze</a></td></tr>
      </table>
      <div>
      <div style="overflow:auto; height:6em;"><br/><a href="">Schere</a><br/><a href="">Paket</a><br/><a href="">Schlüssel</a><br/><a href="">Ring</a><br/><a href="">Tanzschuh</a><br/><a href="">roter Fisch</a><br/><a href="">ein kleines Etwas mit einem Nagel drin</a></div></div>
      </div>
   </body>
</html>
